<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="十二の博客宇宙"><meta name="description" content="规则引擎平台开发面试题1、你有使用过哪些规则引擎？对它们有什么评价？
答：我使用过的规则引擎有 Drools， MVEL，Ease Rules。从使用场景来说，Drools适用于项目周期长，规则复杂，规则变更频率高的这样一些场景，MVEL "><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>十二の博客宇宙</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" type="text/css" href="/css/reward.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 6.3.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="十二の博客宇宙" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><style type="text/css" lang="css">#loading-container{position:fixed;top:0;left:0;min-height:100vh;width:100vw;z-index:9999;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;text-align:center;-webkit-transition:opacity 1s ease;-moz-transition:opacity 1s ease;-o-transition:opacity 1s ease;transition:opacity 1s ease}.loading-image{width:120px;height:50px;transform:translate(-50%)}.loading-image div:nth-child(2){-webkit-animation:pacman-balls 1s linear 0s infinite;animation:pacman-balls 1s linear 0s infinite}.loading-image div:nth-child(3){-webkit-animation:pacman-balls 1s linear .33s infinite;animation:pacman-balls 1s linear .33s infinite}.loading-image div:nth-child(4){-webkit-animation:pacman-balls 1s linear .66s infinite;animation:pacman-balls 1s linear .66s infinite}.loading-image div:nth-child(5){-webkit-animation:pacman-balls 1s linear .99s infinite;animation:pacman-balls 1s linear .99s infinite}.loading-image div:first-of-type{width:0;height:0;border:25px solid #49b1f5;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_up .5s 0s infinite;animation:rotate_pacman_half_up .5s 0s infinite}.loading-image div:nth-child(2){width:0;height:0;border:25px solid #49b1f5;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_down .5s 0s infinite;animation:rotate_pacman_half_down .5s 0s infinite;margin-top:-50px}@-webkit-keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@-webkit-keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@-webkit-keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}@keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}.loading-image div:nth-child(3),.loading-image div:nth-child(4),.loading-image div:nth-child(5),.loading-image div:nth-child(6){background-color:#49b1f5;width:15px;height:15px;border-radius:100%;margin:2px;width:10px;height:10px;position:absolute;transform:translateY(-6.25px);top:25px;left:100px}.loading-text{margin-bottom:20vh;text-align:center;color:#2c3e50;font-size:2rem;box-sizing:border-box;padding:0 10px;text-shadow:0 2px 10px rgba(0,0,0,.2)}@media only screen and (max-width:500px){.loading-text{font-size:1.5rem}}.fadeout{opacity:0}@-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}@keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0)}}</style><script>setTimeout(function(){const e=document.getElementById("loading-container");e.className="fadeout",setTimeout(function(){e.style.display="none"},2500)},1e3)</script><body><div id="loading-container"><p class="loading-text">嘘~ 正在从服务器偷取页面 . . .</p><div class="loading-image"><div></div><div></div><div></div><div></div><div></div></div></div><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><div><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">十二の博客宇宙</span></div></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><span>统计</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:.6"></i> <span>分类</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:.6"></i> <span>归档</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-list" style="zoom:.6"></i> <span>娱乐</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/movies"><i class="fas fa-film" style="margin-top:-20px;zoom:.6"></i> <span>电影</span></a></li><li><a href="/books"><i class="fas fa-book" style="margin-top:-20px;zoom:.6"></i> <span>读书</span></a></li><li><a href="/games"><i class="fas fa-gamepad" style="margin-top:-20px;zoom:.6"></i> <span>游戏</span></a></li><li><a href="/bangumis"><i class="fas fa-film" style="margin-top:-20px;zoom:.6"></i> <span>番剧</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/artitalk" class="waves-effect waves-light"><i class="fas fa-comment" style="zoom:.6"></i> <span>说说</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">十二の博客宇宙</div><div class="logo-desc">许多时候，称谓并不重要，重要的是对方一直在那个位置上，从未被挪动。</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fas fa-fw fa-link"></i> 统计 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-list"></i> 娱乐 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/movies" style="margin-left:75px"><i class="fa fas fa-film" style="position:absolute;left:50px"></i> <span>电影</span></a></li><li><a href="/books" style="margin-left:75px"><i class="fa fas fa-book" style="position:absolute;left:50px"></i> <span>读书</span></a></li><li><a href="/games" style="margin-left:75px"><i class="fa fas fa-gamepad" style="position:absolute;left:50px"></i> <span>游戏</span></a></li><li><a href="/bangumis" style="margin-left:75px"><i class="fa fas fa-film" style="position:absolute;left:50px"></i> <span>番剧</span></a></li></ul></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li class="m-nav-item"><a href="/artitalk" class="waves-effect waves-light"><i class="fa-fw fas fa-comment"></i> 说说</a></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i>Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/1.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title"></h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><span class="chip bg-color">无标签</span></div></div><div class="col s5 right-align"></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2024-04-19</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2024-04-26</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 9.7k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 33 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h2 id="规则引擎平台开发面试题"><a href="#规则引擎平台开发面试题" class="headerlink" title="规则引擎平台开发面试题"></a>规则引擎平台开发面试题</h2><p><strong>1、你有使用过哪些规则引擎？对它们有什么评价？</strong></p><p>答：我使用过的规则引擎有 Drools， MVEL，Ease Rules。从使用场景来说，Drools适用于项目周期长，规则复杂，规则变更频率高的这样一些场景，MVEL 和 Easy Rules 则适用于使用表达式语义定义规则的场景。从他们的优缺点来看Drools它的文档比较齐全，而且到现在为止处于一种持续更新的状态，相对来说也比较流行，而 MVEL 它的资料相对较少，而且更新也比较少， Easy Rules则是由于GitHub维护者较少，版本更新也比较缓慢，最新的一版发布于23年4月，已经有将近一年的时间没有更新了。所以综上所述，选择Drools会更加的合适。</p><p><strong>2、你在项目中是如何使用规则引擎的？可以举个例子吗？</strong>（规则引擎的特点）</p><p>答：例如我们在项目中有一个告警系统接入规则引擎。首先我们需要配置规则，设置条件为 CPU&gt;70%，满足条件时就会触发告警。当告警系统来匹配的时候，需要在请求中告诉规则引擎此时的CPU占用率为多少，匹配后满足规则触发条件后，将匹配结果传回告警系统。（简单的例子 + 复杂的例子）</p><p><em>积分系统（备用）</em></p><p><em>复杂条件匹配</em>：循环，按需，复杂组合。</p><p>（其中两个参数 ==attributeName=“内存”，attributeValue=“xx%”== ，这两个参数我们拿到之后，会进行一个规则解析，解析完成之后进行规则匹配）–技术</p><p><strong>==3、规则引擎如何与其他技术栈集成？例如，如何与Java后端集成？如何与前端集成？==</strong></p><p>答：与 Java后端集成 —&gt; <strong>SpringBoot+Drools</strong>。首先需要在SpringBoot项目中引入Drools所需要的包，然后配置一个名为DroolsConfig 的 java配置类，在这个类中，我们定义一个<code>KieContainer</code> 的<code>Spring</code> 的 <code>Bean</code> ，<code>KieContainer</code> 用于通过加载应用程序的 <code>/resources</code> 文件夹下的 drl 规则文件来构建规则引擎；然后创建 <code>kieFileSystem</code> 实例配置规则引擎并从应用程序的资源目录来加载 drl 规则文件；接着使用 <code>kieBulider</code> 来构建 <code>drools</code> 模块，然后可以使用 <code>kieService</code> 单例实例来创建 <code>kieBuilder</code> 实例；最后使用 <code>kieService</code> 创建一个 <code>kieContioner</code> 并将其配置为<code>spring bean</code>。（流程 —&gt; 原理）</p><p><strong>4、在使用规则引擎时，你遇到过哪些挑战？如何解决？</strong></p><p>答：（1）在做版本回滚的时候，会出现两个较大的挑战。</p><p><em>为什么要实现版本回滚（具体设计）？</em></p><p>答：因为在规则在更新后，尽管会经过层层审批，在流程上保证了规则修改的影响⾯，但是在实际的业务数据中仍 然可能出现问题，此时就需要版本回滚的能⼒，使得规则回退到上⼀个稳定版本。在实现过程中出现了两个问题。</p><p><em>版本回滚的方案：在规则列表⻚⾯上每次只展示最新记录，操作上新增历史版本 选项，⽤户可以看到每个版本 的记录，按需要实现指定版本的回滚。</em></p><p><em>版本回滚的后端实现：</em></p><ul><li><p><em>设计原则：由于我们的设计上⼀条完整的规则关联了属性表、因⼦表、动作表，因此改动需要尽可能 ⼩，避免影响范围过⼤，造成 更多的⻛险。同时，这是⼀个新增需求，需要兼容以前的数据，兼容性往 往是真实业务第⼀优先考虑的事情。</em></p></li><li><p>*设计思想：由于需要记录每个版本，所以每次修改数据实际都是插⼊⼀条规则，并且规则的唯⼀码不 变。新增⼀个版本号字段，将规则码和版本号作为⼀个联合唯⼀索引，此联合索引作为其他表中的外 键，原来是规则码作为其他表中外键。如此其他表的设计完全不⽤改。兼容性，功能性，易⽤性都很好 的满⾜了。 *</p></li><li><p><em>重要区别：以前是通过规则码可以查询所有相关的数据，现在是规则码+版本号可以查询所有数据，其他 表的外键变为规则码+版本号</em></p></li></ul><p>一是 <strong>版本冗余</strong> 问题，我们要进行规则的回滚，首先要做的就是将之前的规则数据保存在我们的数据库中，但是如果某些规则经常性的进行变更，就会导致规则的版本号一直膨胀，对于我们的数据库来说也是一个不小的负担。要解决这个问题，需要启动一个定时任务，每天去执行一次删除冗余版本，只保留最近的10条数据。由于线上的服务器是多台的，所以没必要每台机器都去执行这个删除任务，因此需要一个Redis分布式锁来实现一个单机删除的功能。</p><p>第二是 <strong>并发修改</strong> 问题，如果有多个用户同时对同一条规则进行修改，例如用户A 提交修改之后，用户B 也提交了修改操作，这样就会导致用户 A 修改的数据被覆盖掉，从而导致一个并发修改的问题。由于这个场景只在压测的时候出现，所以我们这个地方没有使用加锁的方式，而是选择了在用户更新数据之前，先从数据库查询一次最新的版本号，看看是否高于本次提交的版本。</p><p>（2）再一个就是<strong>规则条件的动态解析问题</strong>，这是一个很大的挑战。首先Drools的条件判断是依赖于Java中实体类中的属性和属性值来实现的，例如有这样一个条件：年龄大于20，身高大于180。这个条件在Drools表达式中可以呈现为 User (age &gt; 20 &amp;&amp; height &gt; 180) ，要做到这些首先需要一个User的实体类，其次这个实体类中必须要包含age，height这两个属性。</p><p>但是这样的话就会出现一个问题，当我们的规则条件发生变化，例如添加一个条件：体重小于60，但是恰好这个条件对应的属性weight在实体类User中并不存在，那么就会导致这条规则的条件约束失效。要解决这个问题就需要对实体类进行修改，修改完成后重新发布，但是这样每次新增字段都需要修改类然后重新发布，就会很耗费时间，影响规则引擎的性能，可扩展性也会很差。</p><p>为了解决这个问题，我们就将业务上的一个约束，转换成了技术上的两个约束，从支持的表达式类型出发，每个表达式其实都可以用 Java中的特定类型及其相应方法来实现，例如刚刚提到的例子吗，年龄大于20，对应的类型就是 Integer，而 Integer类型 可以使用的关系表达式在Java中是有一定限制的，大于，等于，或者小于，而这个关系表达式又是可以穷举的，并不多，所以我们就可以根据这些基础类型，匹配相对应的表达式，后端将每个因子条件解析为对应的类型。同时呢为了解决同一个条件会出现多个相同的因子类型，需要区分字段名称，所以我们最终设计的相应的类结构，包含三个属性，attributeName，attributeValue，expression。刚刚所提到的例子 年龄大于20，在这里就可以解析为 IntegerParser(attributeName==”年龄” &amp;&amp; attributeValue &gt; 20)。这样我们的规则条件动态解析就得到了很好的解决，同时在技术上实现了通用的类型解析，业务上也支持了复杂条件判断。</p><p><strong>==5、如果让你设计一个规则引擎，你会考虑哪些因素？如何实现？==</strong></p><p>答：系统设计的思路。</p><p>1、使用场景，存在什么问题。</p><p>2、解决问题</p><p>3、架构设计（流程，模型，功能）</p><p><em><strong>解决实际问题</strong></em></p><p><strong>6、规则引擎适用于哪些场景？在你的项目中，规则引擎解决了什么问题？</strong></p><p>答：适用于那些项目周期长，规则复杂，规则变更频率高的这样一些场景，通常这种业务就会选择接入我们的规则引擎。</p><p>在我的项目中，解决了以下几个问题：</p><p>（1）<strong>规则配置的可视化</strong>：背景 + 问题 + 解决方案</p><p>可视化是为了降低规则配置的门槛，同时也可以提高规则的可维护性。具体实现是将原来只能由技术维护的 drl文件转化为 JSON数据，通过前端将其展示在页面上，进而在页面上可以解析。</p><p>（2）<strong>动态加载规则配置</strong>：</p><p>因为Drools的规则判断强依赖于 .drl 文件，每次修改或者增添一项新的规则，然后要重新启动应用程序，才可以使规则生效，但是在生产中，需要走的流程很多，这种方式很明显会导致产能底下的问题。因此需要对规则进行动态加载，在我们的项目中动态加载的核心能力在于可以从复杂的业务语义中抽象出规则条件，并转化成规则引擎可以识别的语言。从数据库动态的加载数据，之后对数据进行解析，并且拼接成 drl文件，进行规则匹配。</p><p>（3）<strong>快速实现复杂规则需求的问题</strong>：==高效沟通==</p><p>对于一些复杂的规则，我们将他拆分为因子表达式，属性，动作等核心模型，再有基础解析器进行解析，每个条件都可以用基础解析类的固定两个属性来表达，将所有的因子条件根据支持的表达式，类型解析为对应的基础类型，技术上实现了通用的类型解析，满足了扩展性，在业务上支持了复杂条件判断。</p><p><strong>==7、你如何评估规则引擎的性能和可靠性？有什么优化策略？==</strong></p><p>答：通过系统启动速度来评判规则引擎的性能。由于数据量过大的问题，在数据库中读取规则，编译并加载在内存中，从而导致了加载过慢，因此系统启动时间长。为了解决这个问题，可以使用Redis将一些拼接好的热点规则缓存起来，这样就算机器重启服务，也可以从缓存中直接读取到数据，免去各种查询的逻辑耗时。</p><p><em>实测 5 w 条规则启动速度从 130 s提升到了 30 s</em></p><p><strong>8、除了规则引擎，你还了解哪些类似的技术，如何进行选择和权衡？</strong></p><p>答：还有例如 MVEL，Ease Rules。从使用场景来说，Drools适用于项目周期长，规则复杂，规则变更频率高的这样一些场景，MVEL 和 Easy Rules 则适用于使用表达式语义定义规则的场景。从他们的优缺点来看Drools它的文档比较齐全，而且到现在为止处于一种持续更新的状态，相对来说也比较流行，而 MVEL 它的资料相对较少，而且更新也比较少， Easy Rules则是由于GitHub维护者较少，版本更新也比较缓慢，最新的一版发布于23年4月，已经有将近一年的时间没有更新了。所以综上所述，选择Drools会更加的合适。</p><ol><li><p><strong>规则引擎为什么选择Drools</strong></p><p>答：首先从适用场景的方面考虑，Drools更加适合项目周期长，规则复杂，规则变更频率高的业务场景，与当前平台开发的场景相吻合。另外Drools拥有非常活跃的社区支持，不需要担心版本与实际应用脱节的情况。从技术层面考虑，Drools更加的易于使用，且有比较快速的执行速度。最后就是Drools在Java开发人员中很流行，与 Java Rule Engine API（JSR 94）兼容。基于以上的考虑，我们这个开发项目的规则引擎选择Drools。</p></li><li><p><strong>对接了哪些业务</strong></p><p>答：目前的话，我们这个规则引擎对接了很多的业务系统，其中印象我比较深刻的有 <strong>风控系统，告警系统，积分系统、权限系统</strong>这四个业务系统。</p><p><em>四个系统分别是干啥的</em>（简短描述即可）</p><ul><li><p><em>风控系统：风控系统是⼀种⽤于识别和管理⻛险的机制，通常应⽤于⾦融、电商等领域。⻛控系统通过分析⽤ 户⾏为和交易数据等信息，识别潜在的⻛险事件并进⾏控制和管理，从⽽保障系统和⽤户的安全。</em></p></li><li><p><em>告警系统：告警系统是⼀种⽤于监测和通知系统中发⽣异常或重要事件的⼯具。它可以帮助组织及时发现和解决问 题，确保系统的稳定性和可⽤性。</em></p></li><li><p><em>积分系统：积分系统是⼀种常⻅的奖励和激励机制，通常⽤于⿎励⽤户参与某项活动或消费某种商品或服务。积分 系统通过给予⽤户⼀定的积分作为奖励，来激励⽤户的⾏为，从⽽达到促进销售、提⾼⽤户参与度等⽬ 的。</em></p></li><li><p><em>权限系统：权限系统是⼀种⽤于管理⽤户访问权限的机制，它可以控制⽤户对特定资源或服务的访问范围和权 限级别。</em></p></li></ul></li><li><p><strong>举例说明规则如何配置</strong></p><p>答：首先，我们这个规则配置需要在前端页面（可视化）进行，使用人员根据页面提示，选择添加规则，按照顺序填入规则名称，优先级，规则触发条件（比如 age = 30这种简单规则，或者是 (a&gt;b &amp;&amp; b &lt; c || age &gt; 60) 之类的复杂规则），条件触发后的动作等。这些配置完成之后就可以选择提交这个配置好的规则。前后端交互我们使用的是JSON，在后端收到前端传过来的消息后，对JSON数据进行解析，解析完之后，编译并生成对应的规则文件存入到我们的工作内存中并加载，随后等待上游业务来调用匹配规则即可。</p><p>（<em>首先需要再resources目录下建立一个 rules 的文件夹，这个文件夹下可以创建规则文件 rule .drl 编写规则。每一个 drl 文件首先必须要声明一个包名，这个包的包名不做限制可以随便取，但是必须保证包名的唯一性；然后配置 import，导入规则中要使用的类的包或者类，规则判断都是通过实体类中的属性来进行比较；再然后可以选择性的配置我们的全局变量；完成后可以定义需要的规则，</em></p><p><em>包括 ：</em></p><p><em>rule “规则名称”，这个名称也是唯一的，且必须要配置这个规则的名字；</em></p><p><em>when “规则触发条件判定”，例如Person(age&gt;50)，在Person类中，属性age的值大于50；</em></p><p><em>then “触发后的执行动作”，通过调用对象的方法实现；</em></p><p><em>end 作为规则执行结束的标识符。</em></p><p><em>到此就完成了规则的配置。</em>）</p></li><li><p><strong>如何从数据库动态读取到最新的数据</strong></p><p>答：<strong>主要回答加载流程</strong></p><p>==（通俗版）==首先需要我们连接到数据库，并且设计好数据表，把规则的配置存入表中。在程序运行的时候，可以调用一个重新加载的接口（reload）来动态的进行规则加载。在调用reload的时候时，首先会通过 <em><strong>创建一个存放规则的仓库</strong></em> 从 <em><strong>数据库</strong></em> 中中区加载所有的规则，拿到规则之后，通过 <em><strong>一个接口</strong></em> 来加载 规则文件，之后将加载完成的数据放到到内存的文件系统当中，同时通过<em><strong>上述的接口</strong></em>构建一个 <em><strong>虚拟的文件系统</strong></em> ，然后会自动的检查生成的这个文件中是否存在错误，若有错误就抛出异常，若没有就构建一个新的 <em><strong>容器</strong></em>，再把 <em><strong>原来的容器</strong></em> 给替换掉，此时容器中存放的就是我们数据库中最新的数据了，至此也就实现了从数据库动态加载最新的数据这个操作。</p><p>==（专业版）==首先需要我们连接到数据库，并且设计好数据表，把规则的配置存入表中。在程序运行的时候，可以调用一个重新加载的接口（reload）来动态的进行规则加载。在调用reload的时候时，首先会通过 <em><strong>KieRepository</strong></em> 从 <em><strong>DB</strong></em> 中加载所有的规则，拿到规则之后，通过 <em><strong>kieService</strong></em> 来加载规则文件，之后将加载完成的数据放到到内存的文件系统当中，同时通过 <em><strong>kieFileSystem</strong></em> 构建一个 <em><strong>kieBuilder</strong></em> ，使用 buildAll()方法会在构建好虚拟文件后，自动的去构建一个 <em><strong>kieModule</strong></em>，若在检查时文件存在错误，就将异常抛出，若没有就构建一个新的 <em><strong>kieContainer</strong></em>，再把 <em><strong>kieContainer</strong></em> 给替换掉，此时容器中存放的就是我们数据库中最新的数据了，至此也就实现了从数据库动态加载最新的数据这个操作。</p></li><li><p><strong>你参与了哪些功能开发</strong></p><p>答：</p><p>（1）规则条件的动态解析</p><p>（2）业务回调</p><p>（3）规则测试</p><p>（4）规则记录</p><p>（5）版本回滚</p></li><li><p><strong>你遇到的最难的问题是什么, 何如解决的</strong></p><p>答：</p><p>（1）回滚问题：</p><p>在做版本回滚的时候，会出现两个较大的挑战。</p><p><em>为什么要实现版本回滚（具体设计）？</em></p><p>答：因为在规则在更新后，尽管会经过层层审批，在流程上保证了规则修改的影响⾯，但是在实际的业务数据中仍 然可能出现问题，此时就需要版本回滚的能⼒，使得规则回退到上⼀个稳定版本。在实现过程中出现了两个问题。</p><p><em>版本回滚的方案：在规则列表⻚⾯上每次只展示最新记录，操作上新增历史版本 选项，⽤户可以看到每个版本 的记录，按需要实现指定版本的回滚。</em></p><p><em>版本回滚的后端实现：</em></p><ul><li><p><em>设计原则：由于我们的设计上⼀条完整的规则关联了属性表、因⼦表、动作表，因此改动需要尽可能 ⼩，避免影响范围过⼤，造成 更多的⻛险。同时，这是⼀个新增需求，需要兼容以前的数据，兼容性往 往是真实业务第⼀优先考虑的事情。</em></p></li><li><p><em>设计思想：由于需要记录每个版本，所以每次修改数据实际都是插⼊⼀条规则，并且规则的唯⼀码不 变。新增⼀个版本号字段，将规则码和版本号作为⼀个联合唯⼀索引，此联合索引作为其他表中的外 键，原来是规则码作为其他表中外键。如此其他表的设计完全不⽤改。兼容性，功能性，易⽤性都很好 的满⾜了。</em></p></li><li><p><em>重要区别：以前是通过规则码可以查询所有相关的数据，现在是规则码+版本号可以查询所有数据，其他 表的外键变为规则码+版本号</em></p></li></ul><p>一是 <strong>版本冗余</strong> 问题，我们要进行规则的回滚，首先要做的就是将之前的规则数据保存在我们的数据库中，但是如果某些规则经常性的进行变更，就会导致规则的版本号一直膨胀，对于我们的数据库来说也是一个不小的负担。要解决这个问题，需要启动一个定时任务，每天去执行一次删除冗余版本，只保留最近的10条数据。由于线上的服务器是多台的，所以没必要每台机器都去执行这个删除任务，因此需要一个Redis分布式锁来实现一个单机删除的功能。</p><p>第二是 <strong>并发修改</strong> 问题，如果有多个用户同时对同一条规则进行修改，例如用户A 提交修改之后，用户B 也提交了修改操作，这样就会导致用户 A 修改的数据被覆盖掉，从而导致一个并发修改的问题。由于这个场景只在压测的时候出现，所以我们这个地方没有使用加锁的方式，而是选择了在用户更新数据之前，先从数据库查询一次最新的版本号，看看是否高于本次提交的版本。</p><p>（2）对于规则条件的动态解析。</p><p>解决方案：通过有限的基础解系类型来满足无限的因子扩张</p><p>首先由于Drools的条件判断都是依赖于java中实体类的属性和值来实现的，在业务上每一个因子条件都需要存在一个实体类的一个属性来承接。因此在制定规则的时候，需要绑定一个实体类。添加的因子条件也必须解析为实体类中的属性。</p><p>这时候问题就来了，因为我们的业务需求是在时刻变化的，如果新增的因子条件并不存在于现有的实体类中，那么该条件约束就会失效。例如，我们需要在原本的规则式中 User(age &gt; 12 &amp;&amp; height &gt; 168)添加一个条件，weight &gt; 60，而原本的User类中并没有weight属性，无法实现这个条件，除非修改实体类，然后进行重新发布。这样就会导致，每次有新增的字段，都需要修改实体类，并重新发布，扩展性很差。</p><p>为了解决这个问题，我们从支持的表达式类型出发，每个表达式都可以和 java中支持的特定类型及相应的方法来实现。例如：Integer / Long 类型：支持 &gt;，&lt;， =，!= ；Boolean类型：支持True，False。</p><p>根据这个想法就可以将所有的因子条件根据支持的表达式类型，解析为对应的基础类型，在技术上实现了通用的类型解析，极大地提高了可扩展性，在业务上也可以支持更为复杂的条件判断。同时这个方案也能将技术和业务层面彻底解耦，不管业务层面如何变化，技术层面始终会有基础的类型解析可以去适配相应的规则。</p></li><li><p><strong>用到的设计模式</strong></p><p>答：项目中用到的设计模式主要有 观察者模式，单例模式，代理模式，工厂模式，其中：</p><p>观察者模式，规则完成匹配后，需要做一些其他的业务逻辑，例如，规则记录，业务回调的一些方面。通过新增一个观察者，就可以实现相应的业务逻辑，而不是修改原本的业务代码。</p><p>工厂模式，主要是根据前端传入的数据，进行解析后确定类型然后加载相对应的基础解析器类。</p><p>（例如：Integer –&gt; IntegerParser / String–&gt; StringParser)</p><p>单例模式</p><p>代理模式</p></li><li><p>==<strong>项目的亮点是什么</strong>==</p><p>答：<em>产品视角，了解即可</em></p><ol><li>服务拆分：我们将规则引擎作为独立的微服务，与其他服务进行解耦，实现了服务拆分。</li><li>业务场景驱动的规则设计：我们采用了业务场景驱动的规则设计方法，将业务场景和规则一一对应，实现了规则的可维护性和可扩展性。同时，我们还开发了规则模板和规则库，为业务人员提供了规则设计的参考和支持。</li><li>规则引擎的规范化和标准化：我们遵循了规则引擎的规范和标准，采用了Drools提供的API和DSL，实现了规则的统一管理和执行。同时，我们还开发了规则测试和调试工具，保证了规则的正确性和稳定性。</li></ol></li><li><p><strong>对项目整体设计的一个感受，对你哪方面的成长有积极的促进作用</strong></p><p>答：<em><strong>问题排查流程，从需求到最后结束的过程。开发注意事项，团队协作</strong></em>。</p><p>项目从到最终的完成上线，在这个过程中我学到了很多。</p><p>从项目的需求分析到架构设计，再到功能模块的设计与开发，确定问题排查流程对问题进行一个高效的解决。这些让我了解到了什么是在一个完整的项目开发所必须具备的能力。通过参与到一整个项目的具体开发流程，我也更加深入地了解到一个项目从构建到实现的流程（需求分析 - 架构设计 - 功能设计 - 测试等主要流程），然后通过实际开发项目中的功能点以及功能点对应问题的解决，让我的编程能力得到了很大的提升。同时在开发过程中，团队之间的沟通交流，也让我更加适应团队之间的协作开发。我觉得这些都对我的成长有很大的积极作用。</p></li><li><p><strong>在这个项目中你负责了什么、做了什么、担任了什么角色</strong></p><p>答：在这个项目中，我担任了开发者的角色，并负责规则引擎的动态加载和业务回调的实现，同时也负责规则引擎的测试工作，也负责版本回滚以及模块问题的解决。</p></li><li><p><strong>从这个项目中你学会了那些东西，学会了那些新技术的使用</strong></p><p>答：学会了规则引擎的使用。首先通过这个项目，我更加深入的了解到了一个项目从需求到落地的完整生命周期。学会了对需求文档进行分析，如何与团队中的成员更清晰的表达出自己的想法。在技术层面，通过这个项目我也学会了规则引擎的使用</p></li><li><p><strong>项目中redis 实现了哪些功能</strong></p><p>答：</p><p>（1）版本冗余（redis分布式锁），实现了一个单机删除的能力。</p><p>（2）业务回调中保证了消息的可靠性和持久性。</p></li><li><p><strong>实习做了什么</strong></p><p>答：</p><p>（1）规则测试和问题排查。</p><p>（2）业务需求分析。</p></li><li><p><strong>项目的架构和模块</strong></p><p>答：首先架构层面，这个项目共分为三大架构分别为业务架构，应用架构和部署架构。业务架构分为业务系统，账权和系统能力。应用架构分为管理态，运行态。部署架构决定了服务器的类型和部署数量。</p><p>模块分为：功能模块，工具模块，第三方模块</p><p>其中功能模块包括场景维护，规则维护，规则匹配，业务回调，规则测试，规则记录等。</p><p>工具模块包括缓存模块，配置管理模块</p><p>第三方模块包括Redis，Kafka，Fastjson，Swagger，mybatis等</p></li><li><p><strong>项目用到的组件</strong></p><p>答：Redis，Kafka</p></li><li><p><strong>模块间全部都是通过MQ交互的吗没有利用API吗</strong></p><p>答：只有管理态发送消息到运行态，使用到了MQ。其他的模块之间的交互是通过调用API实现。</p></li><li><p><strong>为什么要用Kafka（MQ）</strong></p><p>答：Kafka是一个开源的分布式消息队列系统，在我们这个项目中，管理态实现规则配置之后，需要将消息发送到MQ，之后由MQ发送到运行态。首先Kafka具有高吞吐量和低延迟，且具备高度的实时数据处理能力，使得管理态可以快速的将消息发送到Kafka，运行态也可以实时地订阅和处理这些消息。其次Kafka就有良好的持久性和可靠性，Kafka可以将消息持久化的存储到磁盘上，并且提供副本机制来确保消息的可靠性。最后就是Kafka消费者更加具有灵活性，消费者可以根据实际情况自由的控制消息的消费行为。对于我们这个规则引擎来说，因为要对接很多不同的业务系统，所以选择Kafka是最符合业务要求的。</p><p><em>MQ——业务上的需求</em></p></li><li><p><strong>Kafka如何保证消息不丢失</strong></p><p>答：这个保证机制很多，在发送消息到消费者接收消息，在每个阶段都有可能会丢失消息，所以我们解决的话也是从多个方面考虑</p><p>（1）第一个是生产者发送消息的时候，可以使用异步回调发送，如果消息发送失败，我们可以通过回调获取失败后的消息信息，可以考虑重试或记录日志，后边再做补偿都是可以的。同时在生产者这边还可以设置消息重试，有的时候是由于网络抖动的原因导致发送不成功，就可以使用重试机制来解决</p><p>（2）第二个在broker中消息有可能会丢失，我们可以通过kafka的复制机制来确保消息不丢失，在生产者发送消息的时候，可以设置一个<strong>acks</strong>，就是确认机制。我们可以设置参数为all，这样的话，当生产者发送消息到了分区之后，不仅仅只在leader分区保存确认，在follower分区也会保存确认，只有当所有的副本都保存确认以后才算是成功发送了消息，所以，这样设置就很大程度了保证了消息不会在broker丢失</p><p>（3）第三个有可能是在消费者端丢失消息，kafka消费消息都是按照offset进行标记消费的，消费者默认是自动按期提交已经消费的偏移量，默认是每隔5秒提交一次，如果出现重平衡的情况，可能会重复消费或丢失数据。我们一般都会禁用掉自动提价偏移量，改为手动提交，当消费成功以后再报告给broker消费的位置，这样就可以避免消息丢失和重复消费了</p></li><li><p><strong>kafka中重复消费的问题如何解决</strong></p><p>答：kafka消费消息都是按照offset进行标记消费的，消费者默认是自动按期提交已经消费的偏移量，默认是每隔5s提交一次，如果出现重平衡的情况，可能会重复消费或丢失数据。我们一般都会禁用掉自动提价偏移量，改为手动提交，当消费成功以后再报告给broker消费的位置，这样就可以避免消息丢失和重复消费了。</p></li><li><p><strong>项目的更新多吗</strong></p><p>答：正常情况两周一次迭代</p></li><li><p><strong>为什么不直接回调而选择MQ进行</strong></p><p>答：首先直接回调可能会出现消息丢失的问题。在回调过程中，如果接收方发生了异常或者网络异常之类的情况，那么我们就无法保证消息的可靠传递。使用MQ就可以很好的解决这个问题，MQ他可以保证消息的可靠行和持久性。回调消息发送到MQ可以进行保存，有效的防止了数据丢失。同时MQ通常具备高可用性和冗余机制，确保消息的可靠传递和处理，即使在系统故障或网络中断的情况下也能保证消息不会丢失。</p><p>其次直接回调也会导致发送方和接收方之间高度耦合。如果接收方发生变化，我们这边也需要根据它的变化来适应业务系统。这种紧密的耦合关系会大大增加系统的复杂性。而使用MQ可以实现解耦，即将消息的发送方和接收方解耦。我们规则引擎只需要将消息发送给MQ中，业务系统可以根据自身需求从MQ中订阅并处理消息。</p><p>第三点就是直接回调会导致异常难以处理。在直接回调中，如果上层业务系统在响应回调时发生异常或者不可用，那我们这边就需要去处理这些异常情况。处理异常可能需要实现额外的错误处理逻辑，以应对接收方的故障或不可用情况。而使用MQ，我们就可以通过消息重试机制或者将失败的消息放回队列中进行处理。无论是在发送方还是接收方出现问题时，消息队列都提供了一种弹性的处理方式，确保消息的可靠传递和处理。</p></li><li><p><strong>你觉得什么时候应该选用API调用什么时候应该选择MQ</strong></p><p>答：API调用通常具有较低的演出，并且可以立即收到响应。调用API通常就是对应用程序需要实时响应，并且直接与业务系统进行交互；或者是应用程序需要进行请求和等待响应的一个交互，这种情况下，可也进行API调用。选择MQ消息队列的情况有以下几种：应用程序需要实现异步处理消息；对数据的可靠性和持久性有要求，在我们这个项目中，在进行业务回调时，就需要将消息存放到MQ中，来保证消息的一个可靠性和持久性。</p></li><li><p><strong>项目中线程池的应用</strong></p><p>答：多个租户同时访问的情况下，可以根据租户当前请求的场景ID，将租户放入线程池中并且设置线程上下文，这样可以保证在当前线程都可以拿到这个租户ID，并且可以保证不会在其他线程到处传递。</p></li><li><p><strong>业务场景它是每个系统一个还是一起用，对应内部线程池参数怎么根据场景配置的</strong></p><p>答：每个系统一个业务场景。我们对每一个租户表中都设有<strong>公钥和私钥</strong>，以确保唯一性和安全性。统一配置。</p><p><em>https就是指在http的基础上用TLS/SSL进行加密，这样通信就不容易收到拦截和攻击。</em></p><p><em>使用两个秘钥来进行加密和解密，称之为非对称加密。</em></p><p><em>这种加密方式映射到服务端和客户端，就是服务端有成对的公钥和私钥，然后公布自己的公钥让客户端知晓，客户端用公钥对数据进行加密得到一串加密后的数据，返回服务端，需要注意的是，这串加密后的数据，必须通过私钥才能够解密，然后服务端使用私钥进行解密，从而达到数据的传输。</em></p><p><em><strong>数字证书：</strong>在服务端发送公钥的时候，首先通过大家都信任的CA来颁发一个数字证书，当客户端收到带有证书的公钥时，再对数据进行加密。</em></p><p><em><strong>数字签名：</strong>当CA收到服务端发送的公钥时，会对公钥及信息进行哈希运算，得到一段较短的哈希字符，在哈希运算以后，CA也会生成一段专门用于数字证书的公钥和私钥，然后用私钥对哈希字符进行加密，这串加密后的字符就是数字签名，之后，CA就可以把包含有数字签名的数字证书颁发给服务端，由服务端发送给客户端，客户端在收到数字证书之后，利用CA公钥把数字证书中的数字签名解密，解密后会得到一串哈希字符，然后再对数字证书中的内容进行哈希运算，将两者相对比，若哈希字符完全相同，说明数字证书是靠谱的。</em></p></li></ol><ul><li><p>项目的规模（多少模块）</p><p>项目共分为三个大模块，18个小模块。其中第一个大模块为业务模块，主要是用来对接上游的业务系统。</p><p>第二大模块就是账权，包含⽤户、账号、⻆⾊等模型， ⽤于做认证+权限管理。</p><p>第三个大模块是系统功能，其中包含了许多的小模块，例如由技术人员负责的与规则本身实现相关的能⼒，</p><p>由业务人员负责的规则配置，规则测试，规则记录，业务回调，导入导出，版本回滚这六个模块。</p><p>由管理员负责的监控，权限，用户接入，审批等模块</p></li><li><p>项目的部署流程</p><p>开发 - 完成提交代码 - 测试 - 预发 - 灰度 - 生产（预发和生产环境下DB公用）- 分批发布，</p><p>其中灰度是使用线上真实的数据，抽取一成打到灰度中，如果出现问题，就回滚灰度的代码，把版本进行回滚。这样做的好处就是可以使用线上的流量来测试新版本有没有问题。</p></li><li><p>项目的周期，到目前已经做了多长时间，第一个版本开发用了多少时间</p></li><li><p>项目的人员配置（开发、测试、前端、后端等）</p><p>后端开发2个，测试和前端都是1个</p></li><li><p>自己负责的模块（功能、自动化）</p><ul><li><p>规则测试：</p></li><li><p>规则记录：</p></li><li><p>版本回滚：</p></li><li><p>规则的动态加载：</p></li></ul></li><li><p>第三方接口异常如何处理的</p><p>主要还是业务回调这一方面，使用http去通知业务系统，这个过程可能会失败。这个时候首先可以考虑官放的retry机制，如果重试三次或以上也失败，就把失败信息记录下来，并通知人工来进行处理。</p></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Sakura</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://anohimono.github.io/2024/04199.html">https://anohimono.github.io/2024/04199.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Sakura</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><span class="chip bg-color">无标签</span></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">多谢大佬赏识，您的鼓励就是我最大的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/loading.gif" data-original="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"xa0Evip1UUNJ5XlYzrmZ5XUC-gzGzoHsz",appKey:"PBzrO9XlhlgX9OjRKHixgZM5",notify:!1,verify:!1,visitor:!0,avatar:"mp",pageSize:"10",lang:"zh-cn",placeholder:"ヾﾉ≧∀≦)o 来呀！快活呀！~",enableQQ:!0,emojiCDN:"//i0.hdslb.com/bfs/emote/",emojiMaps:{tv_doge:"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"},requiredFields:["nick","mail"]})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/2024/04230.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/1.jpg" class="responsive-img" alt=""> <span class="card-title"></span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-04-23 </span><span class="publish-author"><i class="fas fa-user fa-fw"></i> Sakura</span></div></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2024/04198.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/1.jpg" class="responsive-img" alt=""> <span class="card-title"></span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-04-19 </span><span class="publish-author"><i class="fas fa-user fa-fw"></i> Sakura</span></div></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){var n,t,o,i;void 0===window.getSelection||(""+(n=window.getSelection())).length<Number.parseInt("120")||(t=document.getElementsByTagName("body")[0],(o=document.createElement("div")).style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>"),i=document.location.href,o.innerHTML+='<br />来源: 十二の博客宇宙<br />文章作者: Sakura<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200))})</script><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h2, h3, h4"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")});const n="expanded";let i=$("#toc-aside"),l=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){i.hasClass(n)?(i.removeClass(n).hide(),l.removeClass("l9")):(i.addClass(n).show(),l.addClass("l9"));var e="artDetail",o="prenext-posts";if(0!==(e=$("#"+e)).length){let t=e.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+o).width(t)}})})</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2022-2024</span> <a href="/about" target="_blank">Sakura</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">141.6k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2022",n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),r=e.getHours(),o=e.getMinutes(),e=e.getSeconds(),s=Date.UTC(t,"11","20","12","8","46"),i=Date.UTC(n,i,a,r,o,e)-s,a=Math.floor(i/31536e6),r=Math.floor(i/864e5-365*a);t===String(n)?(document.getElementById("year").innerHTML=n,o="This site has been running for "+r+" days",o="本站已运行 "+r+" 天",document.getElementById("sitetime").innerHTML=o):(document.getElementById("year").innerHTML=t+" - "+n,e="This site has been running for "+a+" years and "+r+" days",e="本站已运行 "+a+" 年 "+r+" 天",document.getElementById("sitetime").innerHTML=e)};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/Anohimono" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:2872508031@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2872508031" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2872508031" data-position="top" data-delay="50"><i class="fab fa-qq"></i> </a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,r,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(r),n=document.getElementById(s);t.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s=!0,i=t.title.trim().toLowerCase(),l=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),a=0===(a=t.url).indexOf("/")?t.url:"/"+a,c=-1,u=-1;""!==i&&""!==l&&h.forEach(function(t,e){n=i.indexOf(t),c=l.indexOf(t),n<0&&c<0?s=!1:(c<0&&(c=0),0===e&&(u=c))}),s&&(o+="<li><a href='"+a+"' class='search-result-title'>"+i+"</a>",a=t.content.trim().replace(/<[^>]+>/g,""),0<=u&&(t=u+80,(t=0===(e=(e=u-20)<0?0:e)?100:t)>a.length&&(t=a.length),r=a.substr(e,t),h.forEach(function(t){var e=new RegExp(t,"gi");r=r.replace(e,'<em class="search-keyword">'+t+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/fireworks.js"></script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0],e=(t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a=c[o],i=function(){c=c.filter(function(t){return a!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(a)};(t=a).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),i()):(e=new Image,n=t.getAttribute("data-original"),e.onload=function(){t.src=n,t.removeAttribute("data-original"),i()},t.src!==n&&(e.src=n))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/koharu.model.json"},display:{position:"right",width:145,height:315},mobile:{show:!0,scale:.5},react:{opacityDefault:.7,opacityOnHover:.8},log:!1})</script></body></html>